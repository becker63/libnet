{.passC: staticExec("pkg-config --cflags libnftnl").}
{.passL: staticExec("pkg-config --libs   libnftnl").}

from os import parentDir, `/`
import futhark, os

when defined(useFuthark):
  const
    glibcInclude = staticExec("nix eval --raw nixpkgs#glibc.dev.outPath") & "/include"
    nftnlInclude = staticExec("pkg-config --variable=includedir libnftnl")
    outDir = currentSourcePath.parentDir / "autogenerated"
    outFile = outDir / "generated_nftnl.nim"

  static:
    if not dirExists(outDir):
      createDir(outDir)

  importc:
    # --- Output target ---
    outputPath outFile.string

    # --- Header include roots ---
    path glibcInclude
    path nftnlInclude

    # --- Core libnftnl components ---
    "libnftnl/table.h"
    "libnftnl/chain.h"
    "libnftnl/rule.h"
    "libnftnl/set.h"
    "libnftnl/expr.h"
    "libnftnl/object.h"
